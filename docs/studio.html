<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="theme-color" content="#0b0f17">
  <title>Studio</title>
  <link rel="manifest" href="manifest.webmanifest">
  <style>
    :root{--bg:#0b0f17;--panel:#0f1522;--line:#1f2937;--text:#e5e7eb;--sub:#9ca3af;--accent:#5b21b6}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{display:flex;flex-direction:column;background:var(--bg);color:var(--text);font:14px/1.6 system-ui,Roboto,Arial;overflow:hidden}
    header{display:flex;gap:8px;align-items:center;padding:10px 12px;background:#0f1522;border-bottom:1px solid var(--line)}
    header b{font-weight:600}
    button{border:1px solid var(--line);border-radius:8px;padding:0 12px;height:34px;background:#141c2e;color:var(--text);cursor:pointer;white-space:nowrap}
    button.primary{background:var(--accent);border-color:var(--accent)}
    main{flex:1;display:grid;grid-template-columns:1fr 420px;min-height:0}
    .preview{background:#0b1324;min-width:0;min-height:0}
    #frame{width:100%;height:100%;border:0;background:#0b1324}
    aside#side{border-left:1px solid var(--line);background:#0f1522;display:flex;flex-direction:column;min-width:0;min-height:0}
    .side-tabs{display:flex;gap:8px;padding:8px;border-bottom:1px solid var(--line);position:sticky;top:0;background:#0f1522;z-index:1}
    .side-tabs button{flex:1;border:1px solid var(--line);background:#121a2e;color:var(--text);padding:8px;border-radius:8px}
    .side-tabs button.active{background:#18233c}
    .panel{flex:1;min-height:0;display:none}
    .panel.active{display:flex}
    /* --- Code panel --- */
    #code-panel{flex-direction:column}
    #files{border-bottom:1px solid var(--line);min-height:120px;max-height:40%;overflow:auto;background:#0c1323}
    #files ul{list-style:none;margin:0;padding:8px}
    #files li{padding:8px;border-radius:8px;cursor:pointer}
    #files li.active{background:#121a35}
    #editor{flex:1;display:flex;min-height:0}
    #code{flex:1;min-height:0;width:100%;height:100%;border:0;outline:0;padding:14px 16px;background:#0b1324;color:var(--text);font-family:ui-monospace,Consolas,Menlo,monospace}
    /* --- Chat panel --- */
    #chat-panel{flex-direction:column}
    #chat-log{flex:1;min-height:0;overflow:auto;padding:12px;display:flex;flex-direction:column;gap:10px;background:#0b1324}
    .msg{max-width:90%;padding:10px 12px;border-radius:12px}
    .user{align-self:flex-end;background:#1b2a55}
    .bot{align-self:flex-start;background:#141c2e}
    .meta{font-size:12px;color:var(--sub);margin-top:4px}
    #chat-input-row{display:flex;gap:8px;padding:10px;border-top:1px solid var(--line);background:#0f1522}
    #chat-input{flex:1;min-height:64px;max-height:180px;padding:8px 10px;border:1px solid var(--line);border-radius:8px;background:#0b1324;color:var(--text);resize:vertical}
    #chat-send{height:auto;padding:8px 14px}
    /* --- Mobile --- */
    @media (max-width:900px){
      main{grid-template-columns:1fr;grid-template-rows:56vh 44vh}
      .preview{grid-row:1}
      aside#side{grid-row:2}
    }
  </style>
</head>
<body>
  <header>
    <b>Studio</b>
    <span style="flex:1"></span>
    <button id="save">Enregistrer</button>
    <button id="preview" class="primary">Aperçu</button>
  </header>

  <main>
    <section class="preview"><iframe id="frame" sandbox="allow-scripts"></iframe></section>

    <aside id="side">
      <div class="side-tabs">
        <button id="tab-chat" class="active">Chat IA</button>
        <button id="tab-code">Code</button>
      </div>

      <!-- Chat -->
      <section id="chat-panel" class="panel active">
        <div id="chat-log"></div>
        <div id="chat-input-row">
          <textarea id="chat-input" placeholder="Décris ce que tu veux générer ou modifier"></textarea>
          <button id="chat-send" class="primary">Envoyer</button>
        </div>
      </section>

      <!-- Code -->
      <section id="code-panel" class="panel">
        <div id="files"><ul id="list"></ul></div>
        <div id="editor"><textarea id="code"></textarea></div>
      </section>
    </aside>
  </main>

  <script type="module" src="ai.js"></script>
  <script type="module" src="studio.js"></script>
</body>
</html>
