<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="theme-color" content="#0b0f17">
  <title>Studio</title>
  <link rel="manifest" href="manifest.webmanifest">
  <style>
    :root{
      --bg:#0b0f17; --panel:#0f1522; --line:#1f2937; --text:#e5e7eb; --accent:#5b21b6;
      --leftw:50vw;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{display:flex;flex-direction:column;background:var(--bg);color:var(--text);font:14px/1.6 system-ui,Roboto,Arial;overflow:hidden}

    header{display:flex;gap:8px;align-items:center;padding:10px 12px;background:#0f1522;border-bottom:1px solid var(--line)}
    header b{font-weight:600}
    select,button{border:1px solid var(--line);border-radius:8px;height:34px;background:#141c2e;color:var(--text)}
    button{padding:0 12px;cursor:pointer;transition:all 0.2s}
    button:hover{background:#1a2847}
    button.primary{background:var(--accent);border-color:var(--accent)}
    button.primary:hover{background:#6d28d9}
    button:disabled{opacity:0.5;cursor:not-allowed}
    #preview-select{min-width:180px;padding:0 8px}

    /* PC split */
    main#layout{
      flex:1; min-height:0; display:grid;
      grid-template-columns: var(--leftw) 8px 1fr;
    }
    aside#left{min-width:320px;min-height:0;background:#0f1522;border-right:1px solid var(--line);display:flex;flex-direction:column}
    #gutter{background:#14213d;cursor:col-resize}
    section#preview{min-width:0;min-height:0;background:#0b1324;position:relative;isolation:isolate}
    #frame{width:100%;height:100%;border:0;background:#0b1324;position:relative;z-index:1}
    
    /* Console d'erreurs */
    #console{position:absolute;bottom:0;left:0;right:0;max-height:200px;background:#1a0a0a;border-top:2px solid #dc2626;color:#fca5a5;font:12px ui-monospace,monospace;overflow:auto;padding:8px;display:none}
    #console.visible{display:block}
    #console .error{padding:4px 0;border-bottom:1px solid #7f1d1d}

    /* Onglets PC */
    .side-tabs{display:flex;gap:8px;padding:8px;border-bottom:1px solid var(--line);background:#0f1522;position:sticky;top:0;z-index:1}
    .side-tabs button{flex:1;border:1px solid var(--line);background:#121a2e;color:var(--text);padding:8px;border-radius:8px;transition:all 0.2s}
    .side-tabs button:hover{background:#1a2847}
    .side-tabs button.active{background:#18233c}
    
    .panel{flex:1;min-height:0;display:none;flex-direction:column}
    .panel.active{display:flex}

    /* Code */
    #code-panel{flex-direction:column}
    #files{border-bottom:1px solid var(--line);min-height:120px;max-height:40%;overflow:auto;background:#0c1323}
    #files-header{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:#0a0f1a;border-bottom:1px solid var(--line)}
    #files-header h3{margin:0;font-size:13px;font-weight:600;color:#9ca3af}
    #files-actions{display:flex;gap:6px}
    #files-actions button{height:28px;padding:0 10px;font-size:12px}
    #files ul{list-style:none;margin:0;padding:8px}
    #files li{padding:8px 12px;border-radius:8px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;transition:all 0.15s}
    #files li:hover{background:#0f1729}
    #files li.active{background:#121a35}
    #files li .file-name{flex:1}
    #files li .file-delete{opacity:0;color:#dc2626;font-size:11px;padding:2px 6px;border-radius:4px;transition:opacity 0.2s}
    #files li:hover .file-delete{opacity:1}
    #files li .file-delete:hover{background:#7f1d1d}
    
    #editor{flex:1;display:flex;min-height:0}
    #code{flex:1;min-height:0;width:100%;height:100%;border:0;outline:0;padding:14px 16px;background:#0b1324;color:#e5e7eb;font-family:ui-monospace,Consolas,Menlo,monospace;white-space:pre;overflow:auto;tab-size:2}

    /* Chat */
    #chat-panel{flex-direction:column}
    #chat-log{flex:1;min-height:0;overflow:auto;padding:12px;display:flex;flex-direction:column;gap:10px;background:#0b1324}
    .msg{max-width:90%;padding:10px 12px;border-radius:12px;white-space:pre-wrap;animation:fadeIn 0.3s}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .user{align-self:flex-end;background:#1b2a55}
    .bot{align-self:flex-start;background:#141c2e}
    .bot.error{background:#7f1d1d;color:#fca5a5}
    #chat-input-row{display:flex;gap:8px;padding:10px;border-top:1px solid var(--line);background:#0f1522}
    #chat-input{flex:1;min-height:64px;max-height:180px;padding:8px 10px;border:1px solid var(--line);border-radius:8px;background:#0b1324;color:var(--text);resize:vertical;font-family:inherit}
    #chat-send{height:auto;padding:8px 14px}

    /* Mobile: Tabs en haut, UNE seule vue */
    .m-tabs{display:none}
    @media (max-width:900px){
      .m-tabs{display:flex;gap:8px;padding:8px 12px;background:#0f1522;border-bottom:1px solid var(--line)}
      .m-tabs button{flex:1;border:1px solid var(--line);background:#121a2e;color:var(--text);padding:10px;border-radius:8px;font-size:13px}
      .m-tabs button.active{background:#18233c;border-color:#5b21b6}

      #gutter{display:none !important;}
      main#layout{grid-template-columns:1fr}
      
      /* MASQUER tout par d√©faut */
      aside#left{display:none !important;}
      section#preview{display:none !important;}
      
      /* Afficher selon le mode mobile actif */
      body.m-view-preview section#preview{display:block !important;}
      body.m-view-code aside#left{display:flex !important;}
      body.m-view-chat aside#left{display:flex !important;}
      
      /* Masquer les tabs PC en mobile */
      body.m-view-code .side-tabs,
      body.m-view-chat .side-tabs{display:none !important;}
      
      /* Forcer l'affichage du bon panel en mobile */
      body.m-view-code #code-panel{display:flex !important;}
      body.m-view-code #chat-panel{display:none !important;}
      body.m-view-chat #chat-panel{display:flex !important;}
      body.m-view-chat #code-panel{display:none !important;}
    }
  </style>
</head>
<body class="m-view-preview">
  <header>
    <b>Studio</b>
    <label style="margin-left:12px">Aper√ßu:</label>
    <select id="preview-select" title="Fichier √† pr√©visualiser"></select>
  </header>

  <!-- Tabs Mobile (une seule vue √† la fois) -->
  <div class="m-tabs">
    <button id="m-tab-preview" class="active">üëÅÔ∏è Aper√ßu</button>
    <button id="m-tab-code">üíª Code</button>
    <button id="m-tab-chat">üí¨ Chat IA</button>
  </div>

  <main id="layout">
    <aside id="left">
      <!-- Tabs PC (visible uniquement sur desktop) -->
      <div class="side-tabs">
        <button id="tab-chat" class="active">üí¨ Chat IA</button>
        <button id="tab-code">üíª Code</button>
      </div>

      <!-- Panel Chat -->
      <section id="chat-panel" class="panel active">
        <div id="chat-log"></div>
        <div id="chat-input-row">
          <textarea id="chat-input" placeholder="D√©cris ce que tu veux cr√©er ou modifier...&#10;Exemple: 'cr√©e une page avec un carr√© blanc centr√©'"></textarea>
          <button id="chat-send" class="primary" type="button">Envoyer</button>
        </div>
      </section>

      <!-- Panel Code -->
      <section id="code-panel" class="panel">
        <div id="files">
          <div id="files-header">
            <h3>üìÅ Fichiers</h3>
            <div id="files-actions">
              <button id="new-file" title="Nouveau fichier">+ Nouveau</button>
            </div>
          </div>
          <ul id="list"></ul>
        </div>
        <div id="editor">
          <textarea id="code" spellcheck="false"></textarea>
        </div>
      </section>
    </aside>

    <div id="gutter" aria-label="Redimensionner"></div>

    <section id="preview">
      <iframe id="frame" sandbox="allow-scripts" style="pointer-events: auto;"></iframe>
      <div id="console"></div>
    </section>
  </main>

  <script src="ai.js?v=10"></script>
  <script type="module" src="studio.js?v=10"></script>
</body>
</html>
